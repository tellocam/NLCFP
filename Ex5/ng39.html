
<head>
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src="https://unpkg.com/sunburst-chart"></script>

  <style>body { margin: 0 }</style>

</head>
<body>
  <div id="chart"></div>

  <script>
    const data = 
{ name: "all", calls: 1, size: 0, value: 1.287, min: 1.287, max: 1.287, avg: 1.287, children: [{ name: "ngcore::ParallelFor<int,ngcore::EnterTaskManager()::{lambda(int)#1}>(ngcore::T_Range<int>,ngcore::EnterTaskManager()::{lambda(int)#1},int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 1, size: 0.0004554, value: 0.0004554, min: 0.0004554, max: 0.0004554, avg: 0.0004554} , { name: "MeshOptimize3d::SwapImprove", calls: 10, size: 0.03019, value: 1.003, min: 0.07548, max: 0.1384, avg: 0.1003, children: [{ name: "ngcore::ParallelForRange<netgen::ElementIndex,netgen::MeshOptimize3d::SwapImprove(netgen::Mesh&,netgen::OPTIMIZEGOAL,netgen::NgBitArray const*)::{lambda(auto:1)#1}>(ngcore::T_Range<netgen::ElementIndex>,netgen::MeshOptimize3d::SwapImprove(netgen::Mesh&,netgen::OPTIMIZEGOAL,netgen::NgBitArray const*)::{lambda(auto:1)#1},int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 10, size: 0.01533, value: 0.01533, min: 0.001086, max: 0.002454, avg: 0.001533} , { name: "Build edges", calls: 10, size: 0.00414, value: 0.03503, min: 0.001358, max: 0.01667, avg: 0.003503, children: [{ name: "ngcore::ParallelFor<unsigned long,netgen::BuildEdgeList<netgen::ElementIndex>(netgen::Mesh const&,ngcore::Table<netgen::ElementIndex,netgen::PointIndex>const&,ngcore::Array<std::tuple<netgen::PointIndex,netgen::PointIndex>,unsigned long>&)::{lambda(int)#1}>(ngcore::T_Range<unsigned long>,netgen::BuildEdgeList<netgen::ElementIndex>(netgen::Mesh const&,ngcore::Table<netgen::ElementIndex,netgen::PointIndex>const&,ngcore::Array<std::tuple<netgen::PointIndex,netgen::PointIndex>,unsigned long>&)::{lambda(int)#1},int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 10, size: 0.03089, value: 0.03089, min: 0.00119, max: 0.01647, avg: 0.003089}]} , { name: "CreateSortedTable", calls: 10, size: 0.001123, value: 0.09786, min: 0.007579, max: 0.01284, avg: 0.009786, children: [{ name: "ngcore::ParallelForRange<netgen::PointIndex,ngcore::CreateSortedTable<netgen::ElementIndex,netgen::PointIndex,ngcore::T_Range<netgen::ElementIndex>,netgen::Mesh::CreatePoint2ElementTable(std::optional<ngcore::BitArray>)const::{lambda(auto:1&,netgen::ElementIndex)#1}>(ngcore::T_Range<netgen::ElementIndex>const&,netgen::Mesh::CreatePoint2ElementTable(std::optional<ngcore::BitArray>)const::{lambda(auto:1&,netgen::ElementIndex)#1}const&,std::optional<unsigned long>)::{lambda(auto:1)#1}>(ngcore::T_Range<netgen::PointIndex>,ngcore::Table,int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 10, size: 0.01252, value: 0.01252, min: 0.001093, max: 0.001469, avg: 0.001252} , { name: "CreateTable", calls: 10, size: 0.01116, value: 0.08421, min: 0.006404, max: 0.01136, avg: 0.008421, children: [{ name: "ngcore::ParallelForRange<netgen::ElementIndex,ngcore::CreateTable<netgen::ElementIndex,netgen::PointIndex,ngcore::T_Range<netgen::ElementIndex>,netgen::Mesh::CreatePoint2ElementTable(std::optional<ngcore::BitArray>)const::{lambda(auto:1&,netgen::ElementIndex)#1}>(ngcore::T_Range<netgen::ElementIndex>const&,netgen::Mesh::CreatePoint2ElementTable(std::optional<ngcore::BitArray>)const::{lambda(auto:1&,netgen::ElementIndex)#1}const&,std::optional<unsigned long>)::{lambda(auto:1)#1}>(ngcore::T_Range<netgen::ElementIndex>,ngcore::Table,int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 20, size: 0.05879, value: 0.05879, min: 0.002226, max: 0.004733, avg: 0.002939} , { name: "ngcore::TablePrefixSum2<unsigned int>(ngcore::FlatArray<unsigned int,unsigned long>)::{lambda(ngcore::TaskInfo)#1}", calls: 10, size: 0.006443, value: 0.006443, min: 0.0003835, max: 0.0009519, avg: 0.0006443} , { name: "ngcore::TablePrefixSum2<unsigned int>(ngcore::FlatArray<unsigned int,unsigned long>)::{lambda(ngcore::TaskInfo)#2}", calls: 10, size: 0.007819, value: 0.007819, min: 0.0004321, max: 0.001584, avg: 0.0007819}]}]} , { name: "MeshOptimize3d::SwapImprove loop", calls: 10, size: 0.001585, value: 0.01243, min: 0.0009254, max: 0.001531, avg: 0.001243, children: [{ name: "ngcore::ParallelForRange<unsigned long,netgen::MeshOptimize3d::SwapImprove(netgen::Mesh&,netgen::OPTIMIZEGOAL,netgen::NgBitArray const*)::{lambda(auto:1)#2}>(ngcore::T_Range<unsigned long>,netgen::MeshOptimize3d::SwapImprove(netgen::Mesh&,netgen::OPTIMIZEGOAL,netgen::NgBitArray const*)::{lambda(auto:1)#2},int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 10, size: 0.01084, value: 0.01084, min: 0.0008486, max: 0.001375, avg: 0.001084}]} , { name: "Mesh::BuildBoundaryEdges", calls: 10, size: 0.2449, value: 0.2449, min: 5.571e-05, max: 0.03381, avg: 0.02449} , { name: "Mesh::Compress", calls: 10, size: 0.05831, value: 0.5669, min: 0.04306, max: 0.08832, avg: 0.05669, children: [{ name: "ngcore::ParallelForRange<netgen::ElementIndex,netgen::Mesh::Compress()::{lambda(auto:1)#1}>(ngcore::T_Range<netgen::ElementIndex>,netgen::Mesh::Compress()::{lambda(auto:1)#1},int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 10, size: 0.1627, value: 0.1627, min: 0.01451, max: 0.02207, avg: 0.01627} , { name: "ngcore::ParallelForRange<netgen::SurfaceElementIndex,netgen::Mesh::Compress()::{lambda(auto:1)#2}>(ngcore::T_Range<netgen::SurfaceElementIndex>,netgen::Mesh::Compress()::{lambda(auto:1)#2},int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 10, size: 0.0529, value: 0.0529, min: 0.002291, max: 0.01966, avg: 0.00529} , { name: "ngcore::ParallelForRange<netgen::ElementIndex,netgen::Mesh::Compress()::{lambda(auto:1)#3}>(ngcore::T_Range<netgen::ElementIndex>,netgen::Mesh::Compress()::{lambda(auto:1)#3},int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 10, size: 0.02659, value: 0.02659, min: 0.001832, max: 0.00501, avg: 0.002659} , { name: "ngcore::ParallelForRange<netgen::SurfaceElementIndex,netgen::Mesh::Compress()::{lambda(auto:1)#4}>(ngcore::T_Range<netgen::SurfaceElementIndex>,netgen::Mesh::Compress()::{lambda(auto:1)#4},int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 10, size: 0.01857, value: 0.01857, min: 0.001604, max: 0.002152, avg: 0.001857} , { name: "Mesh::LinkSurfaceElements", calls: 10, size: 0.04601, value: 0.04601, min: 0.002652, max: 0.007016, avg: 0.004601} , { name: "Mesh::CalcSurfacesOfNode", calls: 10, size: 0.0433, value: 0.2018, min: 0.01449, max: 0.02903, avg: 0.02018, children: [{ name: "Mesh::CalcSurfacesOfNode, pointloop", calls: 10, size: 0.02319, value: 0.02319, min: 0.001602, max: 0.004057, avg: 0.002319} , { name: "Mesh::CalcSurfacesOfNode - surfelementht", calls: 10, size: 0.03905, value: 0.03905, min: 0.002769, max: 0.005214, avg: 0.003905} , { name: "Mesh::CalcSurfacesOfNode - surf on node", calls: 10, size: 0.09628, value: 0.09628, min: 0.007183, max: 0.01505, avg: 0.009628}]}]}]} , { name: "FreeOpenElementsEnvironment", calls: 2, size: 0.02373, value: 0.02373, min: 0.007391, max: 0.01634, avg: 0.01186} , { name: "Mesh::Compress", calls: 1, size: 0.01167, value: 0.09469, min: 0.09469, max: 0.09469, avg: 0.09469, children: [{ name: "ngcore::ParallelForRange<netgen::ElementIndex,netgen::Mesh::Compress()::{lambda(auto:1)#1}>(ngcore::T_Range<netgen::ElementIndex>,netgen::Mesh::Compress()::{lambda(auto:1)#1},int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 1, size: 0.01551, value: 0.01551, min: 0.01551, max: 0.01551, avg: 0.01551} , { name: "ngcore::ParallelForRange<netgen::SurfaceElementIndex,netgen::Mesh::Compress()::{lambda(auto:1)#2}>(ngcore::T_Range<netgen::SurfaceElementIndex>,netgen::Mesh::Compress()::{lambda(auto:1)#2},int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 1, size: 0.003658, value: 0.003658, min: 0.003658, max: 0.003658, avg: 0.003658} , { name: "ngcore::ParallelForRange<netgen::ElementIndex,netgen::Mesh::Compress()::{lambda(auto:1)#3}>(ngcore::T_Range<netgen::ElementIndex>,netgen::Mesh::Compress()::{lambda(auto:1)#3},int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 1, size: 0.002532, value: 0.002532, min: 0.002532, max: 0.002532, avg: 0.002532} , { name: "ngcore::ParallelForRange<netgen::SurfaceElementIndex,netgen::Mesh::Compress()::{lambda(auto:1)#4}>(ngcore::T_Range<netgen::SurfaceElementIndex>,netgen::Mesh::Compress()::{lambda(auto:1)#4},int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 1, size: 0.002917, value: 0.002917, min: 0.002917, max: 0.002917, avg: 0.002917} , { name: "Mesh::LinkSurfaceElements", calls: 1, size: 0.004518, value: 0.004518, min: 0.004518, max: 0.004518, avg: 0.004518} , { name: "Mesh::CalcSurfacesOfNode", calls: 1, size: 0.01813, value: 0.05388, min: 0.05388, max: 0.05388, avg: 0.05388, children: [{ name: "Mesh::CalcSurfacesOfNode, pointloop", calls: 1, size: 0.002652, value: 0.002652, min: 0.002652, max: 0.002652, avg: 0.002652} , { name: "Mesh::CalcSurfacesOfNode - surfelementht", calls: 1, size: 0.00508, value: 0.00508, min: 0.00508, max: 0.00508, avg: 0.00508} , { name: "Mesh::CalcSurfacesOfNode - surf on node", calls: 1, size: 0.02802, value: 0.02802, min: 0.02802, max: 0.02802, avg: 0.02802}]}]}]};

const chart_type = 'time';

    const color = d3.scaleOrdinal(d3.schemePaired);

    let getTime = (t) =>
    {
       if(t>=1000)  return (t/1000).toPrecision(4) + '  s';
       if(t>=0.1)   return t.toPrecision(4) + ' ms';
       if(t>=1e-4)  return (t*1e3).toPrecision(4) + ' us';

       return (t/1e6).toPrecision(4) + ' ns';
    };

    const KB_ = 1024;
    const MB_ = KB_*1024;
    const GB_ = MB_*1024;
    let getMemory = (m) =>
    {
       if(m>=GB_)  return (m/GB_).toPrecision(4) + ' GB';
       if(m>=MB_)  return (m/MB_).toPrecision(4) + ' MB';
       if(m>=KB_)  return (m/KB_).toPrecision(4) + ' KB';
       return m.toPrecision(4) + ' B';
    };

    Sunburst()
      .data(data)
      .size('size')
      .color(d => color(d.name))
      .tooltipTitle((d, node) => { return node.parent ? node.parent.data.name + " &rarr; " + d.name : d.name; })
      .tooltipContent((d, node) => {
        if(chart_type=="memory")
        {
          return `Total Memory: <i>${getMemory(d.value)}</i> <br>`
               + `Memory: <i>${getMemory(d.size)}</i>`
        }
        else
        {
          return `Time: <i>${getTime(d.value)}</i> <br>`
               + `calls: <i>${d.calls}</i> <br>`
               + `min: <i>${getTime(d.min)}</i> <br>`
               + `max: <i>${getTime(d.max)}</i> <br>`
               + `avg: <i>${getTime(d.avg)}</i>`
        }
      })
      (document.getElementById('chart'));

      // Line breaks in tooltip
      var all = document.getElementsByClassName('sunbirst-tooltip');
      for (var i = 0; i < all.length; i++) {
          all[i].white_space = "";
      }
  </script>
</body>

