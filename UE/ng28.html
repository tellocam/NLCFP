
<head>
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src="https://unpkg.com/sunburst-chart"></script>

  <style>body { margin: 0 }</style>

</head>
<body>
  <div id="chart"></div>

  <script>
    const data = 
{ name: "all", calls: 1, size: 0, value: 1.233, min: 1.233, max: 1.233, avg: 1.233, children: [{ name: "ngcore::ParallelFor<int,ngcore::EnterTaskManager()::{lambda(int)#1}>(ngcore::T_Range<int>,ngcore::EnterTaskManager()::{lambda(int)#1},int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 1, size: 0.0007044, value: 0.0007044, min: 0.0007044, max: 0.0007044, avg: 0.0007044} , { name: "MeshOptimize3d::SwapImprove", calls: 10, size: 0.02231, value: 0.9135, min: 0.0663, max: 0.1168, avg: 0.09135, children: [{ name: "ngcore::ParallelForRange<netgen::ElementIndex,netgen::MeshOptimize3d::SwapImprove(netgen::Mesh&,netgen::OPTIMIZEGOAL,netgen::NgBitArray const*)::{lambda(auto:1)#1}>(ngcore::T_Range<netgen::ElementIndex>,netgen::MeshOptimize3d::SwapImprove(netgen::Mesh&,netgen::OPTIMIZEGOAL,netgen::NgBitArray const*)::{lambda(auto:1)#1},int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 10, size: 0.01404, value: 0.01404, min: 0.001136, max: 0.001955, avg: 0.001404} , { name: "Build edges", calls: 10, size: 0.002673, value: 0.03221, min: 0.001304, max: 0.01812, avg: 0.003221, children: [{ name: "ngcore::ParallelFor<unsigned long,netgen::BuildEdgeList<netgen::ElementIndex>(netgen::Mesh const&,ngcore::Table<netgen::ElementIndex,netgen::PointIndex>const&,ngcore::Array<std::tuple<netgen::PointIndex,netgen::PointIndex>,unsigned long>&)::{lambda(int)#1}>(ngcore::T_Range<unsigned long>,netgen::BuildEdgeList<netgen::ElementIndex>(netgen::Mesh const&,ngcore::Table<netgen::ElementIndex,netgen::PointIndex>const&,ngcore::Array<std::tuple<netgen::PointIndex,netgen::PointIndex>,unsigned long>&)::{lambda(int)#1},int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 10, size: 0.02953, value: 0.02953, min: 0.00114, max: 0.01739, avg: 0.002953}]} , { name: "CreateSortedTable", calls: 10, size: 0.0007909, value: 0.09206, min: 0.006955, max: 0.02603, avg: 0.009206, children: [{ name: "ngcore::ParallelForRange<netgen::PointIndex,ngcore::CreateSortedTable<netgen::ElementIndex,netgen::PointIndex,ngcore::T_Range<netgen::ElementIndex>,netgen::Mesh::CreatePoint2ElementTable(std::optional<ngcore::BitArray>)const::{lambda(auto:1&,netgen::ElementIndex)#1}>(ngcore::T_Range<netgen::ElementIndex>const&,netgen::Mesh::CreatePoint2ElementTable(std::optional<ngcore::BitArray>)const::{lambda(auto:1&,netgen::ElementIndex)#1}const&,std::optional<unsigned long>)::{lambda(auto:1)#1}>(ngcore::T_Range<netgen::PointIndex>,ngcore::Table,int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 10, size: 0.01082, value: 0.01082, min: 0.0009392, max: 0.00122, avg: 0.001082} , { name: "CreateTable", calls: 10, size: 0.007597, value: 0.08045, min: 0.005835, max: 0.02473, avg: 0.008045, children: [{ name: "ngcore::ParallelForRange<netgen::ElementIndex,ngcore::CreateTable<netgen::ElementIndex,netgen::PointIndex,ngcore::T_Range<netgen::ElementIndex>,netgen::Mesh::CreatePoint2ElementTable(std::optional<ngcore::BitArray>)const::{lambda(auto:1&,netgen::ElementIndex)#1}>(ngcore::T_Range<netgen::ElementIndex>const&,netgen::Mesh::CreatePoint2ElementTable(std::optional<ngcore::BitArray>)const::{lambda(auto:1&,netgen::ElementIndex)#1}const&,std::optional<unsigned long>)::{lambda(auto:1)#1}>(ngcore::T_Range<netgen::ElementIndex>,ngcore::Table,int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 20, size: 0.04615, value: 0.04615, min: 0.001969, max: 0.003471, avg: 0.002308} , { name: "ngcore::TablePrefixSum2<unsigned int>(ngcore::FlatArray<unsigned int,unsigned long>)::{lambda(ngcore::TaskInfo)#1}", calls: 10, size: 0.02068, value: 0.02068, min: 0.0004166, max: 0.01565, avg: 0.002068} , { name: "ngcore::TablePrefixSum2<unsigned int>(ngcore::FlatArray<unsigned int,unsigned long>)::{lambda(ngcore::TaskInfo)#2}", calls: 10, size: 0.006023, value: 0.006023, min: 0.0004268, max: 0.000845, avg: 0.0006023}]}]} , { name: "MeshOptimize3d::SwapImprove loop", calls: 10, size: 0.001107, value: 0.01073, min: 0.0008645, max: 0.001349, avg: 0.001073, children: [{ name: "ngcore::ParallelForRange<unsigned long,netgen::MeshOptimize3d::SwapImprove(netgen::Mesh&,netgen::OPTIMIZEGOAL,netgen::NgBitArray const*)::{lambda(auto:1)#2}>(ngcore::T_Range<unsigned long>,netgen::MeshOptimize3d::SwapImprove(netgen::Mesh&,netgen::OPTIMIZEGOAL,netgen::NgBitArray const*)::{lambda(auto:1)#2},int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 10, size: 0.009623, value: 0.009623, min: 0.0007844, max: 0.001093, avg: 0.0009623}]} , { name: "Mesh::BuildBoundaryEdges", calls: 10, size: 0.2323, value: 0.2323, min: 0.0001022, max: 0.05536, avg: 0.02323} , { name: "Mesh::Compress", calls: 10, size: 0.04162, value: 0.5098, min: 0.03922, max: 0.06184, avg: 0.05098, children: [{ name: "ngcore::ParallelForRange<netgen::ElementIndex,netgen::Mesh::Compress()::{lambda(auto:1)#1}>(ngcore::T_Range<netgen::ElementIndex>,netgen::Mesh::Compress()::{lambda(auto:1)#1},int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 10, size: 0.1434, value: 0.1434, min: 0.0105, max: 0.02675, avg: 0.01434} , { name: "ngcore::ParallelForRange<netgen::SurfaceElementIndex,netgen::Mesh::Compress()::{lambda(auto:1)#2}>(ngcore::T_Range<netgen::SurfaceElementIndex>,netgen::Mesh::Compress()::{lambda(auto:1)#2},int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 10, size: 0.03499, value: 0.03499, min: 0.00234, max: 0.004441, avg: 0.003499} , { name: "ngcore::ParallelForRange<netgen::ElementIndex,netgen::Mesh::Compress()::{lambda(auto:1)#3}>(ngcore::T_Range<netgen::ElementIndex>,netgen::Mesh::Compress()::{lambda(auto:1)#3},int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 10, size: 0.01883, value: 0.01883, min: 0.001703, max: 0.002057, avg: 0.001883} , { name: "ngcore::ParallelForRange<netgen::SurfaceElementIndex,netgen::Mesh::Compress()::{lambda(auto:1)#4}>(ngcore::T_Range<netgen::SurfaceElementIndex>,netgen::Mesh::Compress()::{lambda(auto:1)#4},int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 10, size: 0.01711, value: 0.01711, min: 0.00138, max: 0.002082, avg: 0.001711} , { name: "Mesh::LinkSurfaceElements", calls: 10, size: 0.05214, value: 0.05214, min: 0.003474, max: 0.01854, avg: 0.005214} , { name: "Mesh::CalcSurfacesOfNode", calls: 10, size: 0.05962, value: 0.2018, min: 0.01409, max: 0.03251, avg: 0.02018, children: [{ name: "Mesh::CalcSurfacesOfNode, pointloop", calls: 10, size: 0.01633, value: 0.01633, min: 0.001551, max: 0.001719, avg: 0.001633} , { name: "Mesh::CalcSurfacesOfNode - surfelementht", calls: 10, size: 0.03164, value: 0.03164, min: 0.002802, max: 0.003825, avg: 0.003164} , { name: "Mesh::CalcSurfacesOfNode - surf on node", calls: 10, size: 0.09415, value: 0.09415, min: 0.006824, max: 0.02086, avg: 0.009415}]}]}]} , { name: "FreeOpenElementsEnvironment", calls: 2, size: 0.02121, value: 0.02121, min: 0.007519, max: 0.01369, avg: 0.01061} , { name: "Mesh::Compress", calls: 1, size: 0.006, value: 0.04517, min: 0.04517, max: 0.04517, avg: 0.04517, children: [{ name: "ngcore::ParallelForRange<netgen::ElementIndex,netgen::Mesh::Compress()::{lambda(auto:1)#1}>(ngcore::T_Range<netgen::ElementIndex>,netgen::Mesh::Compress()::{lambda(auto:1)#1},int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 1, size: 0.01371, value: 0.01371, min: 0.01371, max: 0.01371, avg: 0.01371} , { name: "ngcore::ParallelForRange<netgen::SurfaceElementIndex,netgen::Mesh::Compress()::{lambda(auto:1)#2}>(ngcore::T_Range<netgen::SurfaceElementIndex>,netgen::Mesh::Compress()::{lambda(auto:1)#2},int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 1, size: 0.003423, value: 0.003423, min: 0.003423, max: 0.003423, avg: 0.003423} , { name: "ngcore::ParallelForRange<netgen::ElementIndex,netgen::Mesh::Compress()::{lambda(auto:1)#3}>(ngcore::T_Range<netgen::ElementIndex>,netgen::Mesh::Compress()::{lambda(auto:1)#3},int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 1, size: 0.001733, value: 0.001733, min: 0.001733, max: 0.001733, avg: 0.001733} , { name: "ngcore::ParallelForRange<netgen::SurfaceElementIndex,netgen::Mesh::Compress()::{lambda(auto:1)#4}>(ngcore::T_Range<netgen::SurfaceElementIndex>,netgen::Mesh::Compress()::{lambda(auto:1)#4},int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 1, size: 0.001866, value: 0.001866, min: 0.001866, max: 0.001866, avg: 0.001866} , { name: "Mesh::LinkSurfaceElements", calls: 1, size: 0.00408, value: 0.00408, min: 0.00408, max: 0.00408, avg: 0.00408} , { name: "Mesh::CalcSurfacesOfNode", calls: 1, size: 0.002854, value: 0.01436, min: 0.01436, max: 0.01436, avg: 0.01436, children: [{ name: "Mesh::CalcSurfacesOfNode, pointloop", calls: 1, size: 0.001644, value: 0.001644, min: 0.001644, max: 0.001644, avg: 0.001644} , { name: "Mesh::CalcSurfacesOfNode - surfelementht", calls: 1, size: 0.002846, value: 0.002846, min: 0.002846, max: 0.002846, avg: 0.002846} , { name: "Mesh::CalcSurfacesOfNode - surf on node", calls: 1, size: 0.007016, value: 0.007016, min: 0.007016, max: 0.007016, avg: 0.007016}]}]}]};

const chart_type = 'time';

    const color = d3.scaleOrdinal(d3.schemePaired);

    let getTime = (t) =>
    {
       if(t>=1000)  return (t/1000).toPrecision(4) + '  s';
       if(t>=0.1)   return t.toPrecision(4) + ' ms';
       if(t>=1e-4)  return (t*1e3).toPrecision(4) + ' us';

       return (t/1e6).toPrecision(4) + ' ns';
    };

    const KB_ = 1024;
    const MB_ = KB_*1024;
    const GB_ = MB_*1024;
    let getMemory = (m) =>
    {
       if(m>=GB_)  return (m/GB_).toPrecision(4) + ' GB';
       if(m>=MB_)  return (m/MB_).toPrecision(4) + ' MB';
       if(m>=KB_)  return (m/KB_).toPrecision(4) + ' KB';
       return m.toPrecision(4) + ' B';
    };

    Sunburst()
      .data(data)
      .size('size')
      .color(d => color(d.name))
      .tooltipTitle((d, node) => { return node.parent ? node.parent.data.name + " &rarr; " + d.name : d.name; })
      .tooltipContent((d, node) => {
        if(chart_type=="memory")
        {
          return `Total Memory: <i>${getMemory(d.value)}</i> <br>`
               + `Memory: <i>${getMemory(d.size)}</i>`
        }
        else
        {
          return `Time: <i>${getTime(d.value)}</i> <br>`
               + `calls: <i>${d.calls}</i> <br>`
               + `min: <i>${getTime(d.min)}</i> <br>`
               + `max: <i>${getTime(d.max)}</i> <br>`
               + `avg: <i>${getTime(d.avg)}</i>`
        }
      })
      (document.getElementById('chart'));

      // Line breaks in tooltip
      var all = document.getElementsByClassName('sunbirst-tooltip');
      for (var i = 0; i < all.length; i++) {
          all[i].white_space = "";
      }
  </script>
</body>

