
<head>
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src="https://unpkg.com/sunburst-chart"></script>

  <style>body { margin: 0 }</style>

</head>
<body>
  <div id="chart"></div>

  <script>
    const data = 
{ name: "all", calls: 1, size: 0, value: 2.34, min: 2.34, max: 2.34, avg: 2.34, children: [{ name: "ngcore::ParallelFor<int,ngcore::EnterTaskManager()::{lambda(int)#1}>(ngcore::T_Range<int>,ngcore::EnterTaskManager()::{lambda(int)#1},int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 1, size: 0.001044, value: 0.001044, min: 0.001044, max: 0.001044, avg: 0.001044} , { name: "MeshOptimize3d::SwapImprove", calls: 10, size: 0.01989, value: 1.847, min: 0.1667, max: 0.2646, avg: 0.1847, children: [{ name: "ngcore::ParallelForRange<netgen::ElementIndex,netgen::MeshOptimize3d::SwapImprove(netgen::Mesh&,netgen::OPTIMIZEGOAL,netgen::NgBitArray const*)::{lambda(auto:1)#1}>(ngcore::T_Range<netgen::ElementIndex>,netgen::MeshOptimize3d::SwapImprove(netgen::Mesh&,netgen::OPTIMIZEGOAL,netgen::NgBitArray const*)::{lambda(auto:1)#1},int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 10, size: 0.0246, value: 0.0246, min: 0.001239, max: 0.003979, avg: 0.00246} , { name: "Build edges", calls: 10, size: 0.002969, value: 0.01763, min: 0.001483, max: 0.003131, avg: 0.001763, children: [{ name: "ngcore::ParallelFor<unsigned long,netgen::BuildEdgeList<netgen::ElementIndex>(netgen::Mesh const&,ngcore::Table<netgen::ElementIndex,netgen::PointIndex>const&,ngcore::Array<std::tuple<netgen::PointIndex,netgen::PointIndex>,unsigned long>&)::{lambda(int)#1}>(ngcore::T_Range<unsigned long>,netgen::BuildEdgeList<netgen::ElementIndex>(netgen::Mesh const&,ngcore::Table<netgen::ElementIndex,netgen::PointIndex>const&,ngcore::Array<std::tuple<netgen::PointIndex,netgen::PointIndex>,unsigned long>&)::{lambda(int)#1},int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 10, size: 0.01467, value: 0.01467, min: 0.001283, max: 0.002323, avg: 0.001467}]} , { name: "CreateSortedTable", calls: 10, size: 0.0008569, value: 0.1892, min: 0.01173, max: 0.06163, avg: 0.01892, children: [{ name: "ngcore::ParallelForRange<netgen::PointIndex,ngcore::CreateSortedTable<netgen::ElementIndex,netgen::PointIndex,ngcore::T_Range<netgen::ElementIndex>,netgen::Mesh::CreatePoint2ElementTable(std::optional<ngcore::BitArray>)const::{lambda(auto:1&,netgen::ElementIndex)#1}>(ngcore::T_Range<netgen::ElementIndex>const&,netgen::Mesh::CreatePoint2ElementTable(std::optional<ngcore::BitArray>)const::{lambda(auto:1&,netgen::ElementIndex)#1}const&,std::optional<unsigned long>)::{lambda(auto:1)#1}>(ngcore::T_Range<netgen::PointIndex>,ngcore::Table,int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 10, size: 0.06052, value: 0.06052, min: 0.001001, max: 0.05033, avg: 0.006052} , { name: "CreateTable", calls: 10, size: 0.009095, value: 0.1278, min: 0.01062, max: 0.02859, avg: 0.01278, children: [{ name: "ngcore::ParallelForRange<netgen::ElementIndex,ngcore::CreateTable<netgen::ElementIndex,netgen::PointIndex,ngcore::T_Range<netgen::ElementIndex>,netgen::Mesh::CreatePoint2ElementTable(std::optional<ngcore::BitArray>)const::{lambda(auto:1&,netgen::ElementIndex)#1}>(ngcore::T_Range<netgen::ElementIndex>const&,netgen::Mesh::CreatePoint2ElementTable(std::optional<ngcore::BitArray>)const::{lambda(auto:1&,netgen::ElementIndex)#1}const&,std::optional<unsigned long>)::{lambda(auto:1)#1}>(ngcore::T_Range<netgen::ElementIndex>,ngcore::Table,int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 20, size: 0.1061, value: 0.1061, min: 0.004104, max: 0.01956, avg: 0.005303} , { name: "ngcore::TablePrefixSum2<unsigned int>(ngcore::FlatArray<unsigned int,unsigned long>)::{lambda(ngcore::TaskInfo)#1}", calls: 10, size: 0.006002, value: 0.006002, min: 0.0004214, max: 0.0007255, avg: 0.0006002} , { name: "ngcore::TablePrefixSum2<unsigned int>(ngcore::FlatArray<unsigned int,unsigned long>)::{lambda(ngcore::TaskInfo)#2}", calls: 10, size: 0.006661, value: 0.006661, min: 0.0004858, max: 0.001048, avg: 0.0006661}]}]} , { name: "MeshOptimize3d::SwapImprove loop", calls: 10, size: 0.001014, value: 0.01007, min: 0.0008959, max: 0.001446, avg: 0.001007, children: [{ name: "ngcore::ParallelForRange<unsigned long,netgen::MeshOptimize3d::SwapImprove(netgen::Mesh&,netgen::OPTIMIZEGOAL,netgen::NgBitArray const*)::{lambda(auto:1)#2}>(ngcore::T_Range<unsigned long>,netgen::MeshOptimize3d::SwapImprove(netgen::Mesh&,netgen::OPTIMIZEGOAL,netgen::NgBitArray const*)::{lambda(auto:1)#2},int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 10, size: 0.009061, value: 0.009061, min: 0.0008315, max: 0.001149, avg: 0.0009061}]} , { name: "Mesh::BuildBoundaryEdges", calls: 10, size: 0.4426, value: 0.4426, min: 9.197e-05, max: 0.06608, avg: 0.04426} , { name: "Mesh::Compress", calls: 10, size: 0.1245, value: 1.143, min: 0.104, max: 0.1378, avg: 0.1143, children: [{ name: "ngcore::ParallelForRange<netgen::ElementIndex,netgen::Mesh::Compress()::{lambda(auto:1)#1}>(ngcore::T_Range<netgen::ElementIndex>,netgen::Mesh::Compress()::{lambda(auto:1)#1},int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 10, size: 0.3792, value: 0.3792, min: 0.03517, max: 0.047, avg: 0.03792} , { name: "ngcore::ParallelForRange<netgen::SurfaceElementIndex,netgen::Mesh::Compress()::{lambda(auto:1)#2}>(ngcore::T_Range<netgen::SurfaceElementIndex>,netgen::Mesh::Compress()::{lambda(auto:1)#2},int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 10, size: 0.06685, value: 0.06685, min: 0.004897, max: 0.008347, avg: 0.006685} , { name: "ngcore::ParallelForRange<netgen::ElementIndex,netgen::Mesh::Compress()::{lambda(auto:1)#3}>(ngcore::T_Range<netgen::ElementIndex>,netgen::Mesh::Compress()::{lambda(auto:1)#3},int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 10, size: 0.04427, value: 0.04427, min: 0.004174, max: 0.005201, avg: 0.004427} , { name: "ngcore::ParallelForRange<netgen::SurfaceElementIndex,netgen::Mesh::Compress()::{lambda(auto:1)#4}>(ngcore::T_Range<netgen::SurfaceElementIndex>,netgen::Mesh::Compress()::{lambda(auto:1)#4},int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 10, size: 0.04349, value: 0.04349, min: 0.002648, max: 0.01695, avg: 0.004349} , { name: "Mesh::LinkSurfaceElements", calls: 10, size: 0.1199, value: 0.1199, min: 0.01169, max: 0.01224, avg: 0.01199} , { name: "Mesh::CalcSurfacesOfNode", calls: 10, size: 0.06374, value: 0.3647, min: 0.03509, max: 0.04176, avg: 0.03647, children: [{ name: "Mesh::CalcSurfacesOfNode, pointloop", calls: 10, size: 0.0471, value: 0.0471, min: 0.004626, max: 0.004843, avg: 0.00471} , { name: "Mesh::CalcSurfacesOfNode - surfelementht", calls: 10, size: 0.08659, value: 0.08659, min: 0.008308, max: 0.009611, avg: 0.008659} , { name: "Mesh::CalcSurfacesOfNode - surf on node", calls: 10, size: 0.1673, value: 0.1673, min: 0.01612, max: 0.01864, avg: 0.01673}]}]}]} , { name: "FreeOpenElementsEnvironment", calls: 2, size: 0.09761, value: 0.09761, min: 0.02385, max: 0.07377, avg: 0.04881} , { name: "Mesh::Compress", calls: 1, size: 0.01567, value: 0.1084, min: 0.1084, max: 0.1084, avg: 0.1084, children: [{ name: "ngcore::ParallelForRange<netgen::ElementIndex,netgen::Mesh::Compress()::{lambda(auto:1)#1}>(ngcore::T_Range<netgen::ElementIndex>,netgen::Mesh::Compress()::{lambda(auto:1)#1},int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 1, size: 0.03376, value: 0.03376, min: 0.03376, max: 0.03376, avg: 0.03376} , { name: "ngcore::ParallelForRange<netgen::SurfaceElementIndex,netgen::Mesh::Compress()::{lambda(auto:1)#2}>(ngcore::T_Range<netgen::SurfaceElementIndex>,netgen::Mesh::Compress()::{lambda(auto:1)#2},int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 1, size: 0.005745, value: 0.005745, min: 0.005745, max: 0.005745, avg: 0.005745} , { name: "ngcore::ParallelForRange<netgen::ElementIndex,netgen::Mesh::Compress()::{lambda(auto:1)#3}>(ngcore::T_Range<netgen::ElementIndex>,netgen::Mesh::Compress()::{lambda(auto:1)#3},int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 1, size: 0.003619, value: 0.003619, min: 0.003619, max: 0.003619, avg: 0.003619} , { name: "ngcore::ParallelForRange<netgen::SurfaceElementIndex,netgen::Mesh::Compress()::{lambda(auto:1)#4}>(ngcore::T_Range<netgen::SurfaceElementIndex>,netgen::Mesh::Compress()::{lambda(auto:1)#4},int,ngcore::TotalCosts)::{lambda(ngcore::TaskInfo&)#1}", calls: 1, size: 0.002806, value: 0.002806, min: 0.002806, max: 0.002806, avg: 0.002806} , { name: "Mesh::LinkSurfaceElements", calls: 1, size: 0.01184, value: 0.01184, min: 0.01184, max: 0.01184, avg: 0.01184} , { name: "Mesh::CalcSurfacesOfNode", calls: 1, size: 0.006012, value: 0.03497, min: 0.03497, max: 0.03497, avg: 0.03497, children: [{ name: "Mesh::CalcSurfacesOfNode, pointloop", calls: 1, size: 0.004695, value: 0.004695, min: 0.004695, max: 0.004695, avg: 0.004695} , { name: "Mesh::CalcSurfacesOfNode - surfelementht", calls: 1, size: 0.008131, value: 0.008131, min: 0.008131, max: 0.008131, avg: 0.008131} , { name: "Mesh::CalcSurfacesOfNode - surf on node", calls: 1, size: 0.01613, value: 0.01613, min: 0.01613, max: 0.01613, avg: 0.01613}]}]}]};

const chart_type = 'time';

    const color = d3.scaleOrdinal(d3.schemePaired);

    let getTime = (t) =>
    {
       if(t>=1000)  return (t/1000).toPrecision(4) + '  s';
       if(t>=0.1)   return t.toPrecision(4) + ' ms';
       if(t>=1e-4)  return (t*1e3).toPrecision(4) + ' us';

       return (t/1e6).toPrecision(4) + ' ns';
    };

    const KB_ = 1024;
    const MB_ = KB_*1024;
    const GB_ = MB_*1024;
    let getMemory = (m) =>
    {
       if(m>=GB_)  return (m/GB_).toPrecision(4) + ' GB';
       if(m>=MB_)  return (m/MB_).toPrecision(4) + ' MB';
       if(m>=KB_)  return (m/KB_).toPrecision(4) + ' KB';
       return m.toPrecision(4) + ' B';
    };

    Sunburst()
      .data(data)
      .size('size')
      .color(d => color(d.name))
      .tooltipTitle((d, node) => { return node.parent ? node.parent.data.name + " &rarr; " + d.name : d.name; })
      .tooltipContent((d, node) => {
        if(chart_type=="memory")
        {
          return `Total Memory: <i>${getMemory(d.value)}</i> <br>`
               + `Memory: <i>${getMemory(d.size)}</i>`
        }
        else
        {
          return `Time: <i>${getTime(d.value)}</i> <br>`
               + `calls: <i>${d.calls}</i> <br>`
               + `min: <i>${getTime(d.min)}</i> <br>`
               + `max: <i>${getTime(d.max)}</i> <br>`
               + `avg: <i>${getTime(d.avg)}</i>`
        }
      })
      (document.getElementById('chart'));

      // Line breaks in tooltip
      var all = document.getElementsByClassName('sunbirst-tooltip');
      for (var i = 0; i < all.length; i++) {
          all[i].white_space = "";
      }
  </script>
</body>

